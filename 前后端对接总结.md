# ğŸ¯ å‰åç«¯å¯¹æ¥ - å®Œæˆæ€»ç»“

## âœ… å¯¹æ¥å®Œæˆï¼

å‰ç«¯å·²æˆåŠŸä¿®æ”¹ï¼Œæ‰€æœ‰ API è°ƒç”¨å·²ä» Mock æ¨¡å¼åˆ‡æ¢åˆ°è°ƒç”¨çœŸå®çš„ Java åç«¯æ¥å£ã€‚

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

### 1ï¸âƒ£ **services/authContext.tsx** âœ…
**æ”¹åŠ¨å†…å®¹ï¼š**
- å°† `login` æ–¹æ³•ä»åŒæ­¥æ”¹ä¸ºå¼‚æ­¥ (`async`)
- æ·»åŠ ç”¨æˆ·åå‚æ•°ï¼ˆåŸæ¥åªæœ‰å¯†ç ï¼‰
- è°ƒç”¨åç«¯ `POST /api/auth/login` æ¥å£
- è¿”å›çš„ JWT Token ç›´æ¥å­˜å‚¨ï¼Œä¸å†ä½¿ç”¨ç¡¬ç¼–ç çš„ token
- ä¿®æ”¹æ¥å£ç­¾åï¼š`login(username, string, password: string) => Promise<boolean>`

**å‰åå¯¹æ¯”ï¼š**
```typescript
// æ—§ (Mockæ¨¡å¼)
const login = (password: string) => {
  if (password === 'admin123') {
    localStorage.setItem('novatech_auth_token', 'admin-secret-token');
    return true;
  }
  return false;
};

// æ–° (çœŸå®åç«¯)
const login = async (username: string, password: string): Promise<boolean> => {
  const response = await fetch(`${API_BASE_URL}/auth/login`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, password })
  });
  if (response.ok) {
    const data = await response.json();
    localStorage.setItem('novatech_auth_token', data.token);
    setIsAdmin(true);
    return true;
  }
  return false;
};
```

---

### 2ï¸âƒ£ **services/blogService.ts** âœ…
**æ”¹åŠ¨å†…å®¹ï¼š**
- åˆ é™¤æ‰€æœ‰ Gemini AI ç›¸å…³ä»£ç 
- åˆ é™¤å†…å­˜å­˜å‚¨ (`memoryPosts`)
- æ”¹ä¸ºè°ƒç”¨åç«¯ RESTful API
- `getAllPosts()`: `GET /api/posts`
- `getPostById(slug)`: `GET /api/posts/{slug}`
- `savePost()`: `POST /api/posts` (éœ€è¦ JWT Token)

**å…³é”®æ”¹åŠ¨ï¼š**
```typescript
// æ–°å¢ API_BASE_URL
const API_BASE_URL = 'http://localhost:8080/api';

// è·å–æ‰€æœ‰æ–‡ç«  - è°ƒç”¨åç«¯
export const getAllPosts = async (): Promise<BlogPost[]> => {
  const response = await fetch(`${API_BASE_URL}/posts`);
  const posts = await response.json();
  return posts.map((post: any) => ({
    id: post.slug,  // ä½¿ç”¨ slug ä½œä¸º id
    title: post.title,
    excerpt: post.excerpt,
    category: post.category,
    readTime: post.readTime,
    date: post.date,
    tags: post.tags
  }));
};

// è·å–æ–‡ç« è¯¦æƒ… - è°ƒç”¨åç«¯
export const getPostById = async (slug: string): Promise<PostDetail | null> => {
  const response = await fetch(`${API_BASE_URL}/posts/${slug}`);
  if (!response.ok) return null;
  const post = await response.json();
  return {
    id: post.slug,
    title: post.title,
    // ... å…¶ä»–å­—æ®µ
    content: post.content
  };
};

// åˆ›å»ºæ–‡ç«  - è°ƒç”¨åç«¯ï¼ˆéœ€è¦ Tokenï¼‰
export const savePost = async (post: Partial<PostDetail>): Promise<void> => {
  const token = localStorage.getItem('novatech_auth_token');
  const response = await fetch(`${API_BASE_URL}/posts`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({...post})
  });
  if (!response.ok) throw new Error('Failed to save post');
};
```

---

### 3ï¸âƒ£ **pages/Login.tsx** âœ…
**æ”¹åŠ¨å†…å®¹ï¼š**
- æ·»åŠ ç”¨æˆ·åè¾“å…¥æ¡†ï¼ˆåŸæ¥æ²¡æœ‰ï¼‰
- æ”¹ä¸ºå¼‚æ­¥ç™»å½• (`async`)
- æ·»åŠ åŠ è½½çŠ¶æ€æ˜¾ç¤º
- æ”¹è¿›é”™è¯¯æ¶ˆæ¯æ˜¾ç¤º
- æŒ‰é’®ç¦ç”¨çŠ¶æ€æ”¹è¿›

**å…³é”®æ”¹åŠ¨ï¼š**
```typescript
// æ—§ (ä»…å¯†ç )
const handleSubmit = (e: React.FormEvent) => {
  e.preventDefault();
  if (login(password)) {
    navigate('/admin/editor');
  }
};

// æ–° (ç”¨æˆ·å + å¯†ç )
const handleSubmit = async (e: React.FormEvent) => {
  e.preventDefault();
  setIsLoading(true);
  const success = await login(username, password);
  if (success) {
    navigate('/admin/editor');
  } else {
    setError('Invalid username or password');
  }
  setIsLoading(false);
};
```

**é»˜è®¤ç”¨æˆ·åï¼š** `admin`  
**é»˜è®¤å¯†ç ï¼š** `admin123`

---

### 4ï¸âƒ£ **pages/PostDetail.tsx** âœ…
**æ”¹åŠ¨å†…å®¹ï¼š**
- ç®€åŒ–åŠ è½½é€»è¾‘ï¼ˆåˆ é™¤å¤æ‚çš„ç¼“å­˜é€»è¾‘ï¼‰
- ç›´æ¥è°ƒç”¨ `getPostById(slug)` è·å–æ–‡ç« 
- æ”¹è¿›é”™è¯¯å¤„ç†

**å…³é”®æ”¹åŠ¨ï¼š**
```typescript
// æ—§ (å¤æ‚ç¼“å­˜é€»è¾‘)
useEffect(() => {
  let contextMeta = navStatePost;
  if (!contextMeta) {
    const cached = sessionStorage.getItem('novatech_posts');
    if (cached) {
      contextMeta = JSON.parse(cached).find(p => p.id === id);
    }
  }
  const data = await getPostById(id, contextMeta);
}, [id, navStatePost]);

// æ–° (ç›´æ¥è°ƒç”¨åç«¯)
useEffect(() => {
  const data = await getPostById(id);  // ç›´æ¥è°ƒç”¨åç«¯
  setPost(data);
}, [id]);
```

---

### 5ï¸âƒ£ **pages/Editor.tsx** âœ…
**æ”¹åŠ¨å†…å®¹ï¼š**
- æ·»åŠ  `excerpt` å­—æ®µè¾“å…¥
- æ·»åŠ  `tags` å­—æ®µè¾“å…¥ï¼ˆé€—å·åˆ†éš”ï¼‰
- æ·»åŠ  `readTime` å­—æ®µè¾“å…¥
- æ”¹è¿›é”™è¯¯å¤„ç†å’ŒåŠ è½½çŠ¶æ€
- æ”¹ä¸ºå¼‚æ­¥ä¿å­˜

**æ–°å¢è¾“å…¥å­—æ®µï¼š**
```
1. æ ‡é¢˜ (Title)
2. æ‘˜è¦ (Excerpt) - å¯é€‰ï¼Œè‡ªåŠ¨ç”Ÿæˆ
3. åˆ†ç±» (Category)
4. æ ‡ç­¾ (Tags) - é€—å·åˆ†éš”
5. é˜…è¯»æ—¶é—´ (Read Time) - ä¾‹å¦‚ "5 min"
6. å†…å®¹ (Content) - HTML æˆ– Markdown
```

---

## ğŸ”— API å¯¹æ¥å¯¹åº”å…³ç³»

| å‰ç«¯æ“ä½œ | æ—§æ–¹å¼ | æ–°æ–¹å¼ | åç«¯æ¥å£ |
|---------|--------|--------|----------|
| è·å–æ–‡ç« åˆ—è¡¨ | æœ¬åœ° Mock | API è°ƒç”¨ | `GET /api/posts` |
| è·å–æ–‡ç« è¯¦æƒ… | æœ¬åœ° Mock + AI | API è°ƒç”¨ | `GET /api/posts/{slug}` |
| åˆ›å»ºæ–‡ç«  | å†…å­˜å­˜å‚¨ | API è°ƒç”¨ + Token | `POST /api/posts` |
| ç®¡ç†å‘˜ç™»å½• | ç¡¬ç¼–ç éªŒè¯ | API è°ƒç”¨ | `POST /api/auth/login` |

---

## ğŸš€ å¯åŠ¨æ­¥éª¤

### æ­¥éª¤1: å¯åŠ¨åç«¯æœåŠ¡
```bash
# åœ¨ novatech-backend ç›®å½•
mvn spring-boot:run
# æˆ–ä½¿ç”¨ IntelliJ IDEA è¿è¡Œ BlogApplication.java
```

**éªŒè¯åç«¯å¯åŠ¨æˆåŠŸï¼š**
- çœ‹åˆ°æ—¥å¿—: `âœ… Default admin user created`
- è®¿é—® http://localhost:8080/api/posts è¿”å›æ–‡ç« åˆ—è¡¨

### æ­¥éª¤2: å¯åŠ¨å‰ç«¯åº”ç”¨
```bash
cd novatech-blog
npm install  # å¦‚æœè¿˜æ²¡æœ‰å®‰è£…ä¾èµ–
npm run dev
```

**å‰ç«¯è®¿é—®åœ°å€ï¼š** http://localhost:5173

### æ­¥éª¤3: å®Œæ•´æµ‹è¯•æµç¨‹

#### æµ‹è¯• A: æŸ¥çœ‹æ–‡ç« åˆ—è¡¨
1. æ‰“å¼€ http://localhost:5173
2. åº”è¯¥çœ‹åˆ°ä»åç«¯è·å–çš„ 2 ç¯‡ç¤ºä¾‹æ–‡ç« 
3. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ŒæŸ¥çœ‹ Network æ ‡ç­¾ï¼Œç¡®è®¤ API è°ƒç”¨æˆåŠŸ

#### æµ‹è¯• B: æŸ¥çœ‹æ–‡ç« è¯¦æƒ…
1. ç‚¹å‡»ä»»æ„æ–‡ç« å¡ç‰‡
2. åº”è¯¥åŠ è½½å®Œæ•´çš„æ–‡ç« å†…å®¹ï¼ˆæ¥è‡ªåç«¯ï¼‰

#### æµ‹è¯• C: ç®¡ç†å‘˜ç™»å½•
1. ç‚¹å‡»é¡µé¢å³ä¸Šè§’çš„"Admin"æŒ‰é’®
2. è¾“å…¥ç”¨æˆ·å: `admin`
3. è¾“å…¥å¯†ç : `admin123`
4. ç‚¹å‡» Authenticate
5. æˆåŠŸç™»å½•åè·³è½¬åˆ°æ–‡ç« ç¼–è¾‘é¡µé¢

#### æµ‹è¯• D: åˆ›å»ºæ–°æ–‡ç« 
1. ç™»å½•æˆåŠŸåï¼Œåœ¨ç¼–è¾‘é¡µé¢å¡«å†™ï¼š
   - æ ‡é¢˜: "æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« "
   - æ‘˜è¦: "è¿™æ˜¯æ‘˜è¦" (å¯é€‰)
   - åˆ†ç±»: Backend
   - æ ‡ç­¾: Java, Spring (é€—å·åˆ†éš”)
   - é˜…è¯»æ—¶é—´: 5 min
   - å†…å®¹: å†™ä¸€äº›å†…å®¹
2. ç‚¹å‡» Publish
3. æˆåŠŸåè·³è½¬å›é¦–é¡µï¼Œåº”è¯¥çœ‹åˆ°æ–°åˆ›å»ºçš„æ–‡ç« 

---

## ğŸ“Š æ•°æ®æµå‘

### ç”¨æˆ·æµç¨‹å›¾
```
ç”¨æˆ·è®¿é—®é¦–é¡µ
    â†“
å‰ç«¯è°ƒç”¨ getAllPosts()
    â†“
å‘é€ GET /api/posts è¯·æ±‚
    â†“
åç«¯ä»æ•°æ®åº“æŸ¥è¯¢æ–‡ç« 
    â†“
è¿”å› JSON æ•°ç»„
    â†“
å‰ç«¯æ˜¾ç¤ºæ–‡ç« å¡ç‰‡ç½‘æ ¼
```

### åˆ›å»ºæ–‡ç« æµç¨‹
```
ç”¨æˆ·ç‚¹å‡»ç¼–è¾‘ Editor
    â†“
ç”¨æˆ·å¡«å†™æ–‡ç« è¡¨å•
    â†“
ç”¨æˆ·ç‚¹å‡» Publish
    â†“
å‰ç«¯è°ƒç”¨ savePost() å‘é€ POST è¯·æ±‚ + JWT Token
    â†“
åç«¯éªŒè¯ Token å’Œæƒé™
    â†“
åç«¯ä¿å­˜æ–‡ç« åˆ°æ•°æ®åº“
    â†“
è¿”å›æˆåŠŸå“åº”
    â†“
å‰ç«¯é‡å®šå‘åˆ°é¦–é¡µ
    â†“
é¦–é¡µé‡æ–°åŠ è½½æ–‡ç« åˆ—è¡¨ï¼ˆæ˜¾ç¤ºæ–°æ–‡ç« ï¼‰
```

---

## ğŸ” è®¤è¯æµç¨‹

### JWT Token å·¥ä½œåŸç†

1. **ç”¨æˆ·ç™»å½•**
   ```
   POST /api/auth/login
   { "username": "admin", "password": "admin123" }
   â†“
   Response: { "token": "eyJhbGc...", "username": "admin", "role": "ADMIN" }
   ```

2. **å­˜å‚¨ Token**
   ```typescript
   localStorage.setItem('novatech_auth_token', token);
   ```

3. **å‘é€å—ä¿æŠ¤çš„è¯·æ±‚**
   ```typescript
   fetch('/api/posts', {
     headers: {
       'Authorization': `Bearer ${token}`
     }
   });
   ```

4. **åç«¯éªŒè¯**
   - JWT Filter æ‹¦æˆªè¯·æ±‚
   - éªŒè¯ Token æœ‰æ•ˆæ€§
   - å…è®¸è¯·æ±‚é€šè¿‡

---

## âœ¨ åŠŸèƒ½éªŒè¯æ¸…å•

- [x] ç™»å½•åŠŸèƒ½æ­£å¸¸ï¼ˆç”¨æˆ·å + å¯†ç ï¼‰
- [x] è·å–æ–‡ç« åˆ—è¡¨ï¼ˆæ— éœ€ç™»å½•ï¼‰
- [x] è·å–æ–‡ç« è¯¦æƒ…ï¼ˆæ— éœ€ç™»å½•ï¼‰
- [x] åˆ›å»ºæ–‡ç« ï¼ˆéœ€è¦ç™»å½•ï¼‰
- [x] é”™è¯¯å¤„ç†å’Œæç¤º
- [x] åŠ è½½çŠ¶æ€æ˜¾ç¤º
- [x] Token è¿‡æœŸå¤„ç†ï¼ˆå¯é€‰ï¼‰
- [x] CORS è·¨åŸŸè¯·æ±‚æˆåŠŸ

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### Q1: ç™»å½•æ—¶æŠ¥é”™ "Failed to connect to localhost:8080"
**åŸå› ï¼š** åç«¯æœåŠ¡æœªå¯åŠ¨  
**è§£å†³ï¼š** å¯åŠ¨åç«¯æœåŠ¡ `mvn spring-boot:run`

### Q2: ç™»å½•æˆåŠŸä½†åˆ›å»ºæ–‡ç« å¤±è´¥
**åŸå› ï¼š** Token æ— æ•ˆæˆ–è¿‡æœŸ  
**è§£å†³ï¼š** é‡æ–°ç™»å½•ï¼Œè·å–æ–° Token

### Q3: é¦–é¡µæ˜¾ç¤ºä¸ºç©º
**åŸå› ï¼š** åç«¯æœªåˆå§‹åŒ–ç¤ºä¾‹æ•°æ®  
**è§£å†³ï¼š** æ£€æŸ¥åç«¯æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ° "âœ… Sample posts created"

### Q4: ç½‘ç»œè¯·æ±‚å¤±è´¥ CORS é”™è¯¯
**åŸå› ï¼š** è·¨åŸŸé…ç½®é—®é¢˜  
**è§£å†³ï¼š** æ£€æŸ¥åç«¯ SecurityConfig ä¸­çš„ CORS é…ç½®

---

## ğŸ‰ å®ŒæˆçŠ¶æ€

âœ… **å‰åç«¯å¯¹æ¥å·²å®Œæˆï¼**

æ‰€æœ‰ API è°ƒç”¨å·²ä» Mock æ¨¡å¼åˆ‡æ¢åˆ°çœŸå®çš„åç«¯ã€‚ç°åœ¨ï¼š

1. **å‰ç«¯** è°ƒç”¨çœŸå®çš„ Java REST API
2. **åç«¯** è¿”å›æ•°æ®åº“ä¸­çš„çœŸå®æ•°æ®
3. **è®¤è¯** ä½¿ç”¨ JWT Token ä¿æŠ¤å—é™æ¥å£
4. **ç”¨æˆ·** å¯ä»¥åˆ›å»ºã€æŸ¥çœ‹ã€ç®¡ç†æ–‡ç« 

**ä¸‹ä¸€æ­¥å¯ä»¥ï¼š**
- éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
- æ·»åŠ æ›´å¤šåŠŸèƒ½ï¼ˆè¯„è®ºã€ç‚¹èµã€æœç´¢ç­‰ï¼‰
- åˆ‡æ¢åˆ° MySQL æ•°æ®åº“
- æ·»åŠ æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
- å®ç°ç”¨æˆ·æ³¨å†Œ

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„ Network æ ‡ç­¾ï¼Œç¡®è®¤ API è¯·æ±‚
2. æŸ¥çœ‹åç«¯æ§åˆ¶å°æ—¥å¿—ï¼Œç¡®è®¤æœåŠ¡å™¨ç«¯é”™è¯¯
3. æ£€æŸ¥ H2 æ•°æ®åº“æ§åˆ¶å° (http://localhost:8080/h2-console) æŸ¥çœ‹æ•°æ®

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸš€
